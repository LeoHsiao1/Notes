# 交换机

：switch ，又称为多网孔网桥、交换式集线器（比网桥端口多、比集线器能隔离冲突域）。
- 工作在数据链路层。
- 普通的交换机称为第二层交换机，也有工作在物理层的第三层交换机。
- 交换机不但可以隔离冲突域，还可以对转发的数据进行过滤，从而隔离广播风暴。
  - 冲突域是指两个结点同时发送数据时会发生冲突的共享式网络。
  - 广播风暴是指大量广播帧占用带宽导致网络瘫痪。
  - 交换机也会使用生成树协议来避免产生回路。
- 交换机有半双工和全双工两种端口，半双工端口的传输速率只有全双工端口的一半。

## 基本职责

- 对数据帧进行转发或过滤。
- 在源端口和目的端口之间建立虚连接，形成一条专用信道（转发完数据后断开连接）。可以同时在多个端口间建立并发连接。
- 通过自学习的方法自动地建立和维护一个表示目的 MAC 地址与端口对应关系的交换表。

## 分类

按规模分类：
- 工作组级交换机：100 个结点以下。
- 部门级交换机
- 企业级交换机：500 个结点以上。

按结构分类：
- 普通交换机：只能级联。
- 堆叠式交换机
- 箱体模块化交换机

## 交换表

- 交换表中的主要几列信息：目的 MAC 地址（Destination Address）、目的地址所连接的端口号（Destination Port）、目的地址所在的 VLAN 号
  - 例如：端口号“3/4”表示交换机第 3 模块的第 4 端口。
- 交换机刚开机时交换表是空白的。
  - 交换表的建立：检查每个数据帧的目的地址，若在交换表中查到了对应的端口号，则建立虚连接转发数据帧，否则把数据帧向除了源端口以外的所有端口广播，目的结点收到广播帧后会马上做出应答，从而使交换机得到该目的地址与端口的对应关系，写入交换表。特别地，若目的端口就是源端口，则丢弃该数据帧。
  - 交换表的维护（即刷新）：交换表一般存储在交换机的高速缓存内，为了避免占满存储空间，交换表每写入一条新对应关系都会加上一个时间戳，每次使用这条对应关系时会更新时间戳，时间戳最老的一部分对应关系会被删除。
- 交换表分为静态交换表（手动设置）和动态交换表（由交换机自动建立和维护）两种。

## 交换机的数据交换方式

- 快速交换方式：又称为直接交换方式，收到长度为 14 个字节的包头后就开始转发，即接收完整个数据帧之前就开始转发。
  - 这样转发速度快，但不能进行差错控制和流量控制。
- 无碎片交换方式：只检查数据帧的长度是否有 64 字节，一旦收到了 64 个字节就视为有效帧，马上转发，也是接收完整个数据帧之前就开始转发。没有 64 个字节就视为碎片，马上丢弃。
- 存储转发交换方式：先接收整个数据帧，如果检查没有出错的话就存储起来，在对应端口排队转发。
  - 排队转发可以避免端口拥塞，但会增加转发延迟。
  - 这种方式的使用最广泛。

## 虚拟局域网

- 交换机支持建立虚拟局域网（Virtual LAN ，VLAN）：同一个交换机所连接的结点位于同一个物理网段，在交换机上创建虚拟局域网就可以使不同物理网段的主机加入到同一个虚拟网段中。
  - 每个虚拟局域网都是一个独立的子网，构成了一个独立的广播域（广播帧只在该网段内传播）。
  - 不同虚拟局域网的主机之间不能直接通信，必须由路由器提供路由，使用第三层交换机就可以提供路由功能（不过功能还是没有路由器强大）。

虚拟局域网中继协议（VLAN Trunk Protocol ，VTP）：将多个交换机开启 VTP 功能并设置成同一个 VTP 域名，就可以统一配置 VLAN 。
- VTP 会在交换机之间传递 VLAN 的配置信息。
- VTP 域中的交换机有以下三种工作模式。
  - 服务器模式：可以创建、删除和修改 VLAN ，可以学习和转发该 VTP 域的通告。
  - 客户端模式：只可以学习和转发该 VTP 域的通告。
  - 透明模式：可以创建、删除和修改 VLAN ，但只在本地有效，可以转发 VTP 通告，但不学习。
