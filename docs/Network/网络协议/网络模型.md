# 网络模型

- 一个计算机网络系统，比如大学局域网，可能混乱、复杂，因为有很多种通信设备、传输介质、网络协议。为了将它统一、简化，业界通常根据 OCI 或 TCP/IP 模型设计网络系统。

## OSI 网络模型

- 1980 年代，国际标准化组织（International Organization for Standardization ，ISO）制定了开放系统互联（Open System Interconnection ，OSI）网络模型。

- OSI 模型从上到下分为 7 个层次：
  - 应用层（application layer）
    - 负责直接面向用户。
    - 该层的网络协议举例：HTTP、FTP、DNS 。
    - 应用层的软件通常提供了 GUI 页面供用户操作。比如 Web 浏览器采用 HTTP 协议传输数据，会显示美观的网页。
  - 表示层（presentation layer）
    - 负责处理数据格式。比如数据的编码与解码、压缩与解压、加密与加密。
    - 一般软件通过少量代码就处理了数据格式，很少专门设计表示层的网络协议。
  - 会话层（session layer）
    - 负责建立并维持两个主机之间的网络会话，从而方便多次通信。建立会话时可能还需要身份认证、授权。
    - 该层的网络协议举例：SSL、SOCKS、RPC 。
  - 传输层（transport layer）
    - 负责在两个主机之间传输数据。
    - 该层的网络协议主要是 TCP、UDP 。
    - 用户直接使用网络层就能传输数据，而增加传输层是为了控制通信效率、通信质量。
  - 网络层（network layer）
    - 负责连通不同局域网的主机，能进行路由选择、分组转发。
    - 该层的网络协议主要是 IP 。
  - 数据链路层（data link layer）
    - 负责连通两个主机之间的网络信道，从而能传输数据。
    - 细分为两个子层：
      - 逻辑链路控制（Logical Link Control ，LLC）子层：负责控制逻辑信道。
      - 介质访问控制（Medium Access Control，MAC）子层：负责控制物理信道。
    - 该层的网络协议主要是以太网，以帧（frame）为单位传输数据，能进行 MAC 寻址、差错控制。
  - 物理层（physical layer）
    - 负责在双绞线、光纤等传输介质中，以比特（bit）为单位传输数据。不考虑寻址，只管把数据沿着物理信道传输。

- 总结：
  - 每一层的功能不同，因此存在不同用途的网络协议。而一个软件可能使用多种网络协议，同时工作在多个层。
  - 每一层都将该层及其以下层服务封装起来，提供 API 供高层调用。高层调用底层的服务时不需要知道其具体实现方法，像调用一个黑盒。
    - 例如在两个主机分别运行一个软件，使用同一种网络协议（比如 HTTP 或 TCP），就可以相互通信，不需要关注下层的通信细节。
  - 通信子网中的结点通常工作在最下面三层，比如路由器工作在网络层。
  - 假设用户想在主机之间进行网络通信，则可选用 OSI 任意一层的网络协议。主要区别在于：应用层协议最贴近用户，方便人使用。越底层的协议越贴近机器，需要考虑软件配置、硬件配置等复杂因素。

### 协议数据单元

- OSI 每层存在多种网络协议，它们处理数据的通信单位称为协议数据单元（Protocol Data Unit ，PDU），也可泛称为数据包。
- 一个协议数据单元的内容通常分为两部分：
  - 元数据（metadata）：记录该协议的一些参数。
  - 有效载体（payload）：记录要传输的数据。
    - 协议数据单元通常会限制单个数据包的最大体积。如果要传输的 payload 超过了体积限制，则只能拆成多份，放到多个数据包 payload 中传输。

- 例：

  协议  |PDU
  -     |-
  HTTP  |报文（message）
  TCP   |段（segment）
  UDP   |报（datagram）
  IP    |包（packet）
  ICMP  |报文（message）


## TCP/IP 网络模型

- TCP/IP 模型比 OCI 模型更简化，更常用。

- 从上到下分为 4 个层次：
  - 应用层
    - 对应 OSI 最上面的应用层、表示层、会话层。
    - 应用层协议有：基于 TCP 的 HTTP、FTP、telnet、电子邮件协议等，基于 UDP 的 DNS、SNMP（简单网络管理协议）、NFS（网络文件系统）、TFTP（通用文件传输协议）等。
  - 传输层
    - 对应 OSI 的传输层。
    - 主要是 TCP、UDP 两种协议。
  - 网络层
    - 对应 OSI 的网络层。
    - 一方面将传输层的报文封装成分组再选择路由发送，另一方面检查接收到的分组的 IP 地址，若与本地 IP 地址相同则拆除报头再传给传输层，否则选择路由并转发。
  - 网络接口层
    - 对应 OSI 最下面的物理层、数据链路层。

- 当应用层发出数据包时，会先传到传输层，被加上 TCP 头；再传到网络层，被加上 IP 头；最后传到网络接口层，被加上帧头、帧尾。如下：

  ![](./tcpip.png)

<!--
- 例：主机 A 上的一个程序发出一个 HTTP 报文给主机 B 时，具体的通信过程为：
  1. 程序发出 HTTP 报文，属于应用层的服务数据单元。
  2. 向下传到表示层，添加表示层的元数据，封装成表示层的服务数据单元。
  3. 向下传到会话层，

  以此类推。最后传到物理层，以 bit 为单位传输数据。
  2. 主机 B 在物理层收到一组以 bit 为单位的二进制数据，根据元数据识别出它们是数据帧，于是拆除元数据，提取有效载体传到数据链路层处理。数据链路层根据这些数据帧还原出 IP 数据包，提取有效载体传到网络层处理。以此类推，直到传到应用层，还原成一个 HTTP 报文。 -->
