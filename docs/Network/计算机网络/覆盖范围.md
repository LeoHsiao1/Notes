# 覆盖范围

- 根据覆盖范围的不同，可将计算机网络分为三种：局域网、城域网、广域网。
- 电气和电子工程师协会（IEEE）为这三种网络制定了 IEEE 802 标准，细分为 IEEE 802.3、IEEE 802.11 等众多标准。

## 局域网

- 局域网（Local Area Network ，LAN）
  - ：一般覆盖范围为几百米，比如机房。最多为几公里，比如校园网。
  - 简单来说，如果让任意两个主机，通过通信线路连接，进行网络通信。则它们组成了一个最小的局域网。
  - 局域网的覆盖范围小，因此可以采用比较慢的数据传输方式。
  - 在 OSI 网络模型中，局域网包括了物理层和数据链路层。
- 如何组建一个局域网？在 20 世纪，人们研发了多种组建局域网的技术，比如以太网、令牌环。最终，以太网占据了绝大部分市场。

### 以太网

- 以太网（Ethernet）
  - ：于 1970 年代，由施乐（Xerox）公司研发的一种局域网。后来演变为 IEEE 802.3 标准。
  - 世界上存在很多种类型的计算机，硬件层的差异较大，比如网卡型号不同、通信线路不同。使用以太网，这些主机可以在数据链路层连通。
  - 以太网规定了，所有主机在数据链路层的 MAC 子层，统一采用 CSMA/CD 技术来共享信道。
  - 主机需要安装一个以太网网卡，才能进行通信。
- 分类：
  - 标准以太网
    - 传输速率可达 10Mbps 。
    - 让所有主机，组成一个总线型的网络拓扑结构，因此只支持半双工通信。
  - 快速以太网（Fast Ethernet ，FE）
    - 传输速率可达 100Mbps 。
    - 使用交换机连接多个以太网，组成一个星型的网络拓扑结构，因此支持全双工通信。
  - 千兆以太网（Gigabit Ethernet ，GE）
    - 传输速率可达 1000Mbps 。
    - 不存在介质访问控制的问题，所以不需要使用 CSMA/CD 技术。

### 令牌环

- 令牌环（Token Ring）
  - ：于 1980 年代，由 IBM 公司研发的一种局域网。后来演变为 IEEE 802.5 标准。
  - 在 20 世纪末，令牌环与以太网都是主流的局域网技术，但后来以太网
- 原理：
  - 让所有主机，组成一个环形的网络拓扑结构。
  - 一个数据帧（称为令牌），在环中循环传输，每个主机收到数据帧之后，都转发给环中下一个主机。
  - 令牌原本是空载的。一个主机可以往令牌中写入一段数据，然后令牌会依次传递到其它主机，被其它主机看到令牌中的数据。
    - 最终令牌传输一圈，回到原主机。原主机可以检查收到的数据，如果与原数据一样，则说明没有传输出错。
    - 传输完数据之后，原主机可以删除令牌中的数据，使令牌变回空载。
    - 当令牌不是空载时，其它主机都不能往令牌中写入数据。因此它们不能发送数据，只能接收数据。
- 优点：
  - 数据传输一圈的延迟，通常稳定不变、可靠。
  - 同时只有一个主机能发送数据，不会因为多个主机同时发送数据，而产生冲突。
- 缺点：
  - 不支持全双工通信。
  - 数据需要依次经过多个主机，主机越多，延迟越大。

### ATM

- 异步传输模式（Asynchronous Transfer Mode ，ATM）
  - ：于 1980 年代，研发的一种局域网。
  - 它采用分组交换方式，面向连接，传输可靠。
  - 但网速只能达到几百 Mbps ，于是被千兆以太网淘汰。

### WLAN

- 无线局域网（Wireless LAN，WLAN）
  - ：泛指不使用物理线路进行通信的局域网。
  - 目前最常见的一种 WLAN 技术是 Wi-Fi ，因此 WLAN 与 Wi-Fi 几乎成了同义词。

- Wi-Fi
  - 它是 1990 年代研发的一种无线电通信技术，后来演变为 IEEE 802.11 标准。
  - 目前，Wi-Fi 联盟持有 Wi-Fi 商标，可以授权其它公司使用 Wi-Fi 商标。
  - 采用一对多的网络架构。
    - 通常运行一个无线 AP 设备，提供 Wi-Fi 网络，允许多个其它主机连接。
    - 其它主机需要安装 Wi-Fi 网卡，才能进行 Wi-Fi 通信。
  - 常用的无线电频段：
    - 2.4GHz
      - 频率低，波长长，因此穿透力强。
      - 传输速率可达 100Mbps 。
      - 该频段也被蓝牙、无线电话、微波炉等设备使用，因此通信容易受到干扰，导致丢包率增加。
    - 5GHz
      - 频率高，波长短，因此穿透力弱。如果遇到墙壁等障碍物，则会大幅减弱信号。
      - 传输速率可达 1Gbps 。
  - 优点：
    - 兼容以太网。一个使用 Wi-Fi 的主机，与一个使用双绞线的主机，虽然物理层不同，但如果数据链路层都采用以太网协议，则可以相互通信。
    - 室内的传输距离为几十米。室外没有障碍物遮挡的情况下，传输距离为几百米。

### 蓝牙

- 蓝牙（Bluetooth）
  - ：于 1990 年代，研发的一种无线电通信技术。最初用于用于无线耳机，组建一个微型局域网。后来演变为 IEEE 802.15.1 标准。
  - 目前，蓝牙技术联盟持有蓝牙商标，可以授权其它公司使用蓝牙商标。
  - 采用一对一的网络架构，只支持点对点通信。
  - 主机需要安装一个蓝牙芯片，才能进行蓝牙通信。
  - 优点：
    - 耗电量低。
  - 缺点：
    - 传输距离只有几米。
    - 传输速率最大为 2Mbps 。

### Zigbee

- Zigbee
  - ：于 1990 年代，研发的一种无线电通信技术。后来演变为 IEEE 802.15.4 标准。
  - 与蓝牙类似，属于竞品。
  - 优点：
    - 耗电量极低。
  - 缺点：
    - 传输速率只有几百 Kbps 。

## 城域网

- 城域网（Metropolitan Area Network ，MAN）
  - ：一般覆盖几十公里的范围。
  - 换句话说，一个城域网，相当于一个覆盖整个城市的局域网。
  - 局域网很简单，可以私人组建。而城域网、广域网很复杂，一般由专业人员（比如电信运营商）组建、维护。
- 城域网的职责：
  - 向下，连接各个民宅、公司的局域网。
  - 向上，连接其它城域网，或者广域网。
  - 还需要连接电话交换网、广播电视网等网络。

### 相关历史

- 1990 年代，互联网普及到大量民宅。民众可以安装调制解调器（Modem），让计算机通过电话线上网。
  - 所谓的上网，实际上是让本地计算机，通过某种线路，接入城域网，然后间接访问因特网。
  - 这种上网方式，称为拨号上网。
  - 优点：
    - 不需要铺设网线。
  - 缺点：
    - 网速只有几十 kbps 。只能收发电子邮件、查看简陋的 Web 网页。
    - 费用贵，电话公司、电信运营商会分别收费。
    - 电话线不能同时用于两种用途。比如正在上网时，就不能打电话。

- 为了在拨号上网的同时，还能打电话。人们研发了其它拨号上网技术：
  - ISDN（Integrated Service Digital Network ，综合业务数字网）
    - 缺点：需要安装 ISDN 终端设备，成本贵。因此使用 ISDN 的用户不多。
  - ADSL
    - 原理：采用频分多路复用技术，将电话线分成三个信道：电话信道、计算机上行信道、计算机下行信道。
    - 下行速率为几 Mbps ，上行速率为几百 Kbps 。
    - 使用 ADSL 线路时，

- 2000 年代，中国的电信运营商，主要推销 ADSL 上网服务，称为宽带。宽带是指网络的带宽高。

- 2010 年代，中国的电信运营商，主要推销光纤宽带服务。
  - 优点：下行速率为几十 Mbps ，甚至几百 Mbps 。
  - 缺点：需要铺设光纤，接入每个民宅。

- 当计算机通过 ADSL 等线路接入城域网之后，还需要通过电信运营商的身份认证，才能进行网络通信。常见的几种认证协议：
  - IPoE（Internet Protocol over Ethernet）
    - 它将 IP 数据包，封装在以太网帧中传输。也可通过 ATM 网络传输，此时称为 IPoA 协议。
    - 不使用专用的客户端软件，而是要求用户访问一个 Web 网站，输入账号、密码，进行身份认证。也可能不要求身份认证。
    - 通过 DHCP 协议，给用户计算机分配一个 IP 。
  - PPPoE（Point-to-Point Protocol Over Ethernet）
    - 它将点对点协议（PPP）的报文，封装在以太网帧中传输。从而实现身份验证、加密的功能，而单纯的以太网不能实现这些功能。
    - 要求用户启动 PPPoE 客户端软件，输入账号、密码，进行身份认证。然后给用户计算机分配一个公网 IP 。

### 接入技术

用户可以通过多种通信线路，接入城域网，例如：
- xDSL 接入技术
  - 20 世纪末，很多用户住宅已经铺设了电话线路，连接到本地电话局。
    - 而 xDSL 接入技术，是利用已有的铜制电话线路，增加安装调制解调器。使得电话线路，既可以打电话，也可以宽带上网。
  - xDSL 泛指各种数字用户线路（Digital Subscribe Line），例如：
    - ADSL ：非对称数字用户线路。从用户到电话局的传输速率（即上行速率），不同于从电话局到用户的传输速率（即下行速率），通常小 10 倍。
    - HDSL ：高速率数字用户线路。
  - 优点：
    - 不需要重新建设通信线路。
  - 缺点：
    - 传输速率为几 Mbps ，传输距离为几公里。

- 光纤同轴电缆混合网（HFC）接入技术
  - 主要用于有线电视网络。
  - 原理：有线电视台的电信号，先经过调制解调器，调制成光信号，通过光纤传输。到达用户住宅后，再经过调制解调器，解调成电信号，最后通过同轴电缆传输给用户。

- 光纤接入技术（Fibre To The Home，FTTH）
- 局域网接入技术
- 无线接入技术

## 广域网

- 广域网（Wide Area Network ，WAN）
  - ：一般覆盖几百公里到几千公里的范围，甚至跨洋。
- 互联网
  - 通常指因特网（Internet），是全球最大的广域网。
  - 也可以泛指所有计算机网络，此时写作 internet 。
- 电信运营商
  - ：指提供固定电话、移动电话、互联网接入服务的通信服务公司。
  - 中国存在四大电信运营商：电信、联通、移动、广电。除此之外还有很多小的运营商。
- 互联网服务提供商（Internet Service Provider ，ISP）
  - ：指提供互联网接入服务的电信运营商。
- 互联网内容提供商（Internet Content Provider ，ICP）
  - ：指在互联网上提供信息的个体，比如搜索网站、新闻网站。

### 相关历史

- 20 世纪，人们开始研发计算机网络。当时很少为计算机专门铺设通信线路，而是使用已经普及的电话交换网。
  - 由于计算机只能识别数字信号，电话线只能传输模拟信号，需要使用调制解调器（Modem），转换两种信号。
  - 采用电路交换方式，组成以每个交换机为中心的星-星网络架构。一个交换机或中继线路故障，就会中断整个通信网络。
- 1969 年，美国国防部建立了 ARPAnet（阿帕网）。
  - 它是第一个采用分组交换方式的计算机网络，也是最早使用 TCP/IP 协议的网络。
  - 最初，它只有位于四所大学的四个节点。
  - 后来，人们以阿帕网作为主干网，连接了各地的城域网、广域网，发展出了互联网。

- 1970 年代，欧美几大电信公司开会，制定了 X.25 网络协议，希望组建一个更好的广域网。
  - 它采用的交换方式是，分组交换。
  - X.25 是第一个面向连接的网络，之后的帧中继网、ATM 网络都是面向连接的网络。
  - 后来，X.25 协议被 TCP/IP 协议淘汰。

- 1980 年代，基于 X.25 协议，人们研发了一种新的广域网技术：帧中继（Frame Relay）
  - 以帧为单位传输数据，帧的大小可变。这样使得网络传输速度更快。
  - 当数据传输出错时，不会尝试纠正，而是丢弃出错的帧、重新传输。
    - 这是因为此时，数字信道开始普及。与以前的电话线等模拟信道相比，数字信道的误码率很低，很少出错。

## 中国网络

### 相关历史

- 1945 年，中国邮电部成立。
- 1900 年，中国国家计算机与网络设施（NCFC）开始建设，后来发展为 CSTNET 。
  - 同年，中国注册了顶级域名 .CN 。
- 1994 年，NCFC 首次连接到 Internet 。
  - 同年，清华大学建设了 CERNET ，是第一个全国范围的广域网。
  - 同年，为了打破中国邮电部的一家垄断，成立了中国联通。
- 1995 年，中国邮电部建设了 ChinaNet 广域网，覆盖全国。
- 1997 年，邮电分营，中国邮电部拆分为邮政局和电信局。电信局在 ChinaNet 骨干网之下开始建设各地的省网、城域网。
- 2003 年，ChinaNet 取消省网，网络结构变为骨干网、城域网两级。骨干网分为核心层、汇聚层、接入层三级。
- 2004 年，中国电信开始建设 CN2 网。
- 2000 年，电信局拆分为中国移动通信集团公司、中国电信集团公司。
- 2002 年，中国电信在北方几省的公司与小网通、吉通合并，成立中国网通。它建设了 CNCNET 骨干网，还继承了中国邮电部以前建设的 China169 网。
  - 因此中国联通的业务主要在北方，中国电信的业务主要在南方。
- 2009 年，中国网通合并到中国联通。

### 骨干网

中国境内网络，接入全球互联网时，主要有几条线路：
- ChinaNet / China163
  - ：中国电信的一个骨干网，路由节点的 IP 以 202.97 开头。
  - 供大众用户使用，高峰期时每个人分到的境外带宽低于 10 Kbps ，丢包率超过 50% ，QOS 很低。
- CN2
  - ：中国电信的下一代骨干网（Chinatelecom Next Carrier Network ，CNCN），路由节点的 IP 以 59.43 开头。
  - 供政企客户使用，提供高 QOS 服务。
  - 细分了多种服务质量：
    - CN2 GT ：较差的 CN2 服务，省级、出国为 163 线路，国际为 CN2 线路。
    - CN2 GIA ：最好的 CN2 服务，省级、出国、国际都走 CN2 线路，从不走 163 线路。
    - 双向 CN2 线路：出国、回国流量都走 CN2 线路。
    - 单相 CN2 线路：一般是出国流量走 CN2 线路，回国流量走 163 线路，高峰期依然拥挤。
  - 可以在个人电脑上用 traceroute 命令测试访问一个境外 IP ，看经过的各个路由节点的 IP 是否以 59.43 开头，从而判断是否使用了 CN2 线路。
- China169
  - ：中国联通的一个骨干网，供大众用户使用。
- CMNET
  - ：中国移动的一个骨干网，供大众用户使用。
- CERNET
  - ：中国教育科研网，连通了中国大部分高校的校园网。
- CSTNET
  - ：中国科学技术网，供中科院等科研单位使用。

### GFW

中国境内的电脑用户，访问很多境外网站时会失败，主要有两方面原因：
- 大众用户一般通过较差的骨干网接入全球互联网，因此网速慢、带宽低、丢包率高。
  - 解决方案：花钱让服务器或客户端使用 CN2 等高质量网络线路。
- GFW 防火墙将一些网站、公网 IP 加入了黑名单，禁止境内用户访问。
  - 中国国家防火墙（Great Firewall，GFW）会在电信运营商的路由器处，审查所有网络数据包（包括境内流量、境外流量），如果发现违规流量，则进行封禁。
  - GFW 从 1998 年开始运行，封禁的范围越来越大。常见的几种封禁：
    - DNS 污染：当用户访问一个域名时，将该域名 DNS 解析到错误的 IP 。
    - TCP/UDP 端口封禁：当用户访问一个境外公网 IP 的某端口时（比如 TCP 80 端口），丢弃网络包，或返回 RST 包、拒绝端口连接。
    - IP 封禁：当用户访问一个境外公网 IP 时，丢弃网络包。此时用 ping 命令不会连通。
  - 一些境内用户会通过 ss 等代理工具连接境外未被封禁的主机，间接访问被封禁的境外网站，并加密网络流量，避免被 GFW 发现。该行为称为翻墙、挂梯子。对此 GFW 增加了一些检测方式：
    - 被动检测：用机器学习技术，检查网络流量是否符合某些代理协议的特征。
    - 主动探测：根据代理协议，测试发送一些网络包给某个主机，然后根据主机的响应，判断它是否为代理服务器。
