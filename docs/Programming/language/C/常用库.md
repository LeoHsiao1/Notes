# 常用库

- C 语言官方提供了一些标准库，定义了一些常用的函数、常量、宏定义等。用户在源文件中 include 对应的头文件，就可以使用这些标准库。
- 用户也可以下载第三方编写的库，例如：
  - `windows.h` ：提供了 Windows 系统的很多 API 。比如 `Sleep()` 函数，用于暂停程序一定毫秒。
  - `curl/curl.h` ：提供了 libcurl 库的一些函数，用于 HTTP、HTTPS、FTP 等网络协议的通信。
  - `cJSON.h` ：用于处理 JSON 格式的字符串。

## stdafx.h

- Visual Studio 2010 中，将 `stdio.h`、`stdlib.h`、`windows.h` 等头文件都包含到了 `stdafx.h`（标准应用程序框架的扩展）中。
  - 它属于预编译头文件，将一些经常调用的代码预先编译好了。
  - 导入该头文件时，需要使用双引号，即 `#include "stdafx.h"` 。

## stddef.h

- 它是一个标准库，定义了一些变量类型、宏。其它标准库头文件，大多导入了这个头文件。
- 它定义了 size_t 数据类型，通常用于接收 sizeof 的返回值。
  - 在 32 位 CPU 上，size_t 被定义为 `unsigned int` 。
  - 在 64 位 CPU 上，size_t 被定义为 `unsigned long long` 。

## stdio.h

- stdio.h 用于处理标准输入和输出（standard input and output），也就是如何让程序输入、输出字符串。
- stdio.h 定义了一个结构体 `FILE` ，用于存储文件流。

- stdio.h 定义了三个特殊的文件，表示在电脑终端显示的三种内容：
  - stdin ：标准输入。用户通过键盘在终端输入的字符串，通常会写入 stdin 文件，程序可通过 stdin 读取该字符串。
  - stdout ：标准输出。程序通过 print() 函数打印的字符串，通常会写入 stdout 文件，然后显示在终端。
  - stderr ：标准错误。程序的报错信息，通常会写入 stderr 文件，然后显示在终端。

### stdout

- 以下几个函数，用于输出字符串：
  ```c
  int putchar(int char);
      // 将一个字符 char 输出到 stdout
      // 例如：putchar('H');

  int puts(const char *str);
      // 将一个字符串 str 输出到 stdout ，并在末尾加上 \n
      // 例如：puts("Hello World!");

  int printf(const char *format, ...);
      // 按照 format 格式生成一个字符串，输出到 stdout
      // 省略号 ... 可以填入任意个变量，用于嵌入任意个值，到 format 字符串中
      // 该函数的返回值是一个数字，表示成功输出了几个字符

  int fprintf(FILE *stream, const char *format, ...);
      // 按照 format 格式生成一个字符串，输出到 stream 文件流

  int sprintf(char *str, const char *format, ...);
      // 按照 format 格式生成一个字符串，输出到 str
      // 如果函数执行成功，则返回输出的字符串长度（不包括末尾的空字符 \0 ）
      // 如果函数执行失败，则返回一个负数

  int snprintf(char *str, size_t n, const char *format, ...);
      // 与 sprintf 类似，但限制生成的字符串最大长度为 n bytes （包括末尾的空字符 \0 ）
      // 如果生成的字符串长度大于 n ，则只取前 n-1 个字符，然后加上一个空字符 \0 结尾，输出到 str
      // 如果函数执行成功，则不管生成的字符串长度是否大于 n ，总是返回输出到 str 的字符串长度
  ```

- 与 sprintf() 函数相比，snprintf() 更安全，可避免输出的字符串，超过 str 容量。
  ```c
  char *buffer = malloc(sizeof(char) * 10);
  int len = 0;
  len = snprintf(buffer, 6, "%d.1234", 0);
  printf("buffer=%s\n", buffer);  // 输出为：buffer=0.123
  printf("len=%d\n", len);        // 输出为：len=6
  ```

### format

- printf()、scanf() 等函数，函数名都带 f 后缀，表示采用特定格式（format）来处理字符串。
  - format 是一个字符串，用于控制格式，它可以包含任意个普通字符、格式控制符。

- 格式控制符，表示此处存在一个值，并声明其数据类型、显示格式。
  - 存在多种格式控制符：
    ```c
    %d    // 表示 decimal 十进制数字，对应 int 或 short 数据类型
    %u    // unsigned int 或 unsigned short
    %ld   // long
    %lu   // unsigned long

    %f    // float
    %lf   // double
    %Lf   // long double

    %c    // char 数据类型
    %s    // 字符串

    %e    // 按科学计数法显示的值
    %o    // 八进制格式的值
    %#o   // 八进制格式的值，并且加上 0 前缀
    %x    // 十六进制格式的值，并且每个字母小写
    %X    // 十六进制格式的值，并且每个字母大写
    %#x   // 十六进制格式的值，并且加上 0x 前缀
    %#X   // 十六进制格式的值，并且加上 0X 前缀
    %p    // 指针指向的内存地址，是一个十六进制格式的值，加上 0x 前缀
    ```
  - 各个格式控制符，都以百分号 % 开头。如果用户想在 format 字符串中包含一个普通的百分号，则需要使用 `%%` 。
  - 例：
    ```c
    #include <stdio.h>

    int main() {
        int x = 10;
        printf("%d\n", x);    // 输出为：10
        printf("%f\n", 10.2); // 输出为：10.200000
        printf("%d\n", 10.2); // 用 %d 处理浮点数会出错，这里输出为：2147483638
        printf("%f\n", 3);    // 用 %f 处理整数会出错，这里会输出最近一个浮点数：10.200000

        printf("%e\n", 10.2); // 输出为：1.020000e+01

        int octal_num = 075;
        int hex_num = 0x1F;
        printf("octal_num=%o, hex_num=%X\n", octal_num, hex_num); // 输出为：octal_num=75, hex_num=1F
        printf("octal_num=%o, hex_num=%X\n", 10, 10);   // 输出为：octal_num=12, hex_num=A

        printf("%d\n", &x);   // 输出为：681891340
        printf("%x\n", &x);   // 输出为：28a4d60c
        printf("%p\n", &x);   // 输出为：0x7ffc28a4d60c

        return 0;
    }
    ```

- 输出一个值时，可以用 `%m.n` 的格式，使得至少为 m ，使得小数点后的位数为 n 。
  - m 用于控制输出的最少字符数（包括小数点）。
    ```c
    printf("--%5d--", 1);
        // 如果实际总位数小于 m ，则在左侧加上空格（因为排版为右对齐），补齐位数
        // 输出为：--    1--
    printf("--%05d--", 1);
        // 可以改用 0 补齐位数
        // 输出为：--00001--
    printf("--%5s--", "test");
        // 同理，可以控制 %s 输出的最少字符数
        // 输出为：-- test--
    ```
  - n 用于控制小数点后的保留位数。
    ```c
    printf("--%5.2f--", 1.0);
        // 输出为：-- 1.00--
    printf("--%05.2f--", 1.0);
        // 输出为：--01.00--
    printf("--%5f--", 1.0);
        // 如果不指定 n ，则默认小数点后默认保留 6 位
        // 输出为：--1.000000--
    printf("--%5.2f--", 1.056);
        // 如果小数点后实际位数大于 n ，则进行 5 舍 6 入，不是四舍五入
        // 输出为：-- 1.06--
    ```
  - 输出负数时，默认包含负号。而输出正数时，默认不包含正号，除非使用 `%+` 。
    ```c
    printf("--%5d--", 1);
        // 输出为：--    1--
    printf("--%+5d--", 1);
        // 输出为：--   +1--
    ```
  - 默认排版为右对齐，如果使用 `%-` ，则改为左对齐。
    ```c
    printf("--%5d--", 1);
        // 输出为：--    1--
    printf("--%-5d--", 1);
        // 输出为：--1    --
    ```

### stdin

- 以下几个函数，用于读取字符串：
  ```c
  int getchar(void);
      // 从 stdin 读取一个字符，作为函数的返回值
      // 例如：char c = getchar();

  char *gets(char *str);
      // 从 stdin 读取一个字符串，存储到 str 中
      // 例如：char str[10]; gets(str);

  int scanf(const char *format, ...);
      // 从 stdin 读取一个字符串，并按照 format 格式，从中提取值
      // 省略号 ... 可以填入任意个变量，用于存储提取的各个值
      // 并且，这里不能直接填入变量的名称，而需要填入变量的地址，比如用 & 取地址运算符
      // 该函数的返回值是一个数字，表示成功解析了几个值

  int sscanf(const char *str, const char *format, ...);
      // 读取 str 这个字符串，并按照 format 格式，从中提取输入值
  ```

- 例：从 stdin 读取一个值
  ```c
  int x = 0;
  printf("Please enter: ");
  scanf("%d", &x);
      // 假设用户输入 10 ，则 x 会被赋值为 10
      // 假设用户输入 10.2 ，则 x 会被赋值为 10 ，因为 %d 只会识别整数
      // 假设用户输入 a ，则 x 依然取值为 0 ，因此 %d 只会识别整数
  printf("You entered: %d\n", x);

  scanf("x=%d", &x);
      // 假设用户输入 x=10 ，则 x 会被赋值为 10
      // 假设用户输入 10 ，则 x 依然取值为 0 ，因为输入必须符合 x=%d 格式，才能被解析

  scanf("%3d", &x);
      // 这是只提取数字的前 3 位
      // 假设用户输入 123456 ，则 x 会被赋值为 123

  scanf("%*d.%d", &x);
      // 这是只提取小数部分
      // %* 表示解析一个值之后，不存储到变量
      // 假设用户输入 3.14 ，则 x 会被赋值为 14
  ```

- 例：从 stdin 读取多个值
  ```c
  int a=0, b=0 , c=0;
  printf("Please enter: ");
  int ret = scanf("%d %d %d", &a, &b, &c);
      // 假设用户输入 1 2 3 ，则结果为 ret=3, a=1, b=2, c=3
      // 假设用户输入 1  2   3 ，插入多个空字符，则依然能解析成功，结果为 ret=3, a=1, b=2, c=3
      // 假设用户输入 1  b ，包含非数字，则从二个变量开始解析失败，结果为 ret=1, a=1, b=0, c=0
  printf("ret=%d, a=%d, b=%d, c=%d\n", ret, a, b, c);
  if (ret != 3)
      printf("Failed to read all values.\n");
  ```

- 例：从 stdin 读取一个字符串
  ```c
  char str[10];
  printf("Please enter: ");
  scanf("%s", str);
  printf("You entered: %s\n", str);
  ```

- 使用 `%[字符组]s` 的格式解析输入字符串时，只会提取在字符组中存在的字符，其它字符则当作定界符。
  - 例：
    ```c
    scanf("%3[0-9]s", str);
        // 假设用户输入 123456 ，则结果为 str=123
        // 假设用户输入 12a3 ，则结果为 str=12
    ```
  - 用 `a-z`、`0-9` 的格式可匹配一组 ASCII 编码连续的字符。
  - 如果想直接匹配负号 `-` ，则必须将它放在字符组的末尾。
  - 使用 `%[^字符组]` 的格式读取输入时，只会提取在字符组中不存在的字符。
  - 当 scanf() 读取到定界符时，会停止解析当前这个值，然后解析下一个值。
    - scanf() 中，默认的定界符是空字符。gets() 中，默认的定界符是换行符。
    - 假设用户用键盘输入 `Hello World!` 然后按下 Enter 键。用 `scanf("%s", str);` 会解析得到 `Hello` ，用 `gets(str);` 则会解析得到 `Hello World!` 。

### stderr

- 大部分情况下，用户只会用到 stdin、stdout 。如果需要使用 stderr ，则可通过以下方式，输出字符串作为报错：
  ```c
  fprintf(stderr, "test\n");
  fprintf(stderr, "%s\n", "test");
  ```

- `errno.h` 定义了一个全局变量 errno ，用于记录 C 语言程序，最近调用的一个函数的报错信息。
  - 如果调用一个函数出错，则通常返回值为负数，并且给 errno 赋值一个数字，作为错误代码。
  - 如果调用一个函数成功，则通常返回值为 0 ，并且给 errno 赋值为 0 。
  - 例：
    ```c
    #include <stdio.h>
    #include <errno.h>

    int main() {
        printf("errno=%d\n", errno);  // 此时没有函数出错，因此输出为： errno=0
        return 0;
    }
    ```
  - POSIX 定义了一些错误代码，及其描述。
    - 例如 errno=1 对应的错误描述为 Operation not permitted 。
    - 例如 errno=2 对应的错误描述为 No such file or directory 。

- `stdio.h` 提供了 `perror()` 函数，用于查找 errno 对应的错误描述，打印到 stderr 。
  - 例：
    ```c
    #include <stdio.h>

    int main() {
        perror("result"); // 此时没有函数出错，因此输出为： result: Success
        return 0;
    }
    ```
