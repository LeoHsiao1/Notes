# 语法

## 语法特点

- 用 C 语言编写的源代码，一般保存为两种文件：
  - 源文件：扩展名为 `.c` ，主要用于保存各个函数。
  - 头文件：扩展名为 `.h` ，主要用于保存各个变量、函数的声明语句。
- C 语言是编译型语言。源代码不能直接作为程序运行，需要用 gcc 等工具，编译成可执行文件，才能运行。
- C 语言是强类型语言。所有变量，都必须声明数据类型，才能使用。

### 主函数

下例是一个 C 语言源文件 test.c ：
```c
#include <stdio.h>    // 导入头文件 stdio.h ，从而可以使用 printf() 和 scanf() 函数

void main(void){      // 定义主函数
    int x = 0;        // 创建一个变量
    printf("Please enter an integer: ");// 在终端显示一行字符串，给用户看
    scanf("%d", &x);                    // 从终端读取一个值，保存到变量中
    printf("You entered: %d\n ", x);    // 将变量的值打印到终端
    return 0;                           // 终止函数，并返回一个数值
}
```

- 用 C 语言编程时，需要定义有且仅有一个 `main()` 函数，又称为主函数，作为程序运行的入口。
  - 每个函数由一组语句组成，按从上往下的顺序，依次执行这些语句。
  - 每个函数中，可以调用其它任意个函数。
  - 主函数执行的最后一条语句，通常是 `return 0` ，表示终止函数并返回数值 0 。而主函数一旦终止，该程序也运行结束，又称为程序退出。
    - 退出码通常为 0 ，表示该程序正常终止。
    - 如果退出码不为 0 ，则表示该程序异常终止。

- 定义主函数时，有几种格式：
  - 没有返回值，也没有形参：
    ```c
    void main(void)
    ```
  - 返回值为 int 类型，但没有形参：
    ```c
    int main(void)
    ```
  - 返回值为 int 类型，形参用于接收命令行参数：
    ```c
    int main(int argc, char *argv[])
    ```
    假设将该源文件编译为 `test` ，然后在终端执行 `test a b 1 2` 。则操作系统会运行该程序，并传入参数：
    - 将 argv 数组的长度，传给 argc 。本例取值为 5 。
    - 将所有命令行参数（包括程序名称），保存为一个 `char *` 型指针数组，传给 argv 。本例 `argv[0]` 取值为 `test` 。

### 语句

- 语句（statement），是 C 语言代码的基本组成单位。
  - 每条语句必须以分号 `;` 结尾。否则编译器不能识别每条语句到第几个字符结束。
  - 通常在每条语句末尾，加一个换行符。因为如果将多条语句写在同一行，则比较拥挤，不方便人类阅读。

- C 语言的语句分为多种：
  - 空语句
    - ：仅有一个分号，不执行任何操作。
  - 声明语句
    - ：比如声明某个变量的数据类型、声明某个函数头。
  - 执行语句
    - ：比如给某个变量赋值、调用某个函数、执行一个表达式。
  - 复合语句
    - ：用花括号 `{ }` 包住的多条语句，称为一个语句块。

- 缩进
  - 一个语句块，应该在每行开头增加一层缩进，从而方便人类阅读。
  - 如果不加缩进，则代码难以阅读，但并不影响程序的运行。
  - 每层缩进，建议使用两个 Tab ，相当于 8 个空格的长度。如下：
    ```c
    if (x == 1) {
            return x;
    }
    ```
  - 如果一个语句块，只包含一行语句，则可以省略花括号。如下：
    ```c
    if (x == 1)
            return x;
    ```
  - 同时最多使用三层缩进，避免代码太复杂。

- 可以将 C 语言代码中的某些字符，声明为注释，从而被编译器忽略。
  - 单行注释：可以在某行插入 `//` ，将该符号右侧的所有字符，声明为注释。
  - 多行注释：可以在第 m 行插入 `/*` ，在第 n≥m 行插入 `*/` ，从而将这两个符号之间的所有字符，声明为注释。
  - 注释通常用于介绍一段代码的用途、希望达到的效果。而代码本身是怎么写的，应该让人一看就懂，不需要讲解。

## 变量

## 数据类型


## 运算符

- 很多语句包含一个表达式。表达式用于对变量、常量进行某种运算，得到一个值。
- 一个表达式，由运算符（又称为操作符）和操作数组成。
  - 运算符，表示运算的类型，分为多种。
  - 操作数，是运算符的操作对象。
    - 例如 `x = 1 + 2` 中， `=`、`+` 是运算符，`x`、`1`、`2` 是操作数。

- 赋值运算符：
  ```c
  a = 表达式  // 将表达式的值，存储到变量 a 中
  ```
  - 可以在 = 的左侧加一个算术运算符，从而在赋值之前，先执行算术运算。例：
    ```c
    int a = 10;
    a += 1+2;
    printf("%d\n", a);  // 输出为 13
    ```

- 算术运算符：
  ```c
  a + b   // 加法
  a - b   // 减法
  a * b   // 乘法
  a / b   // 除法
  a % b   // 取模
  ```
  - 两个数字做除法时，
    - 如果两个数字，都是整型，则返回值会是整型。此时采用商作为返回值，而余数会被丢弃。
    - 如果任一数字，是浮点型，则返回值会是浮点型。此时余数以小数的形式保留。
    - 例：
      ```c
      printf("%d\n", 1/2);    // 输出为：0
      printf("%f\n", 1/2.0);  // 输出为：0.500000
      printf("%f\n", 2/2.0);  // 输出为：1.000000 ，这里即使能整除，没有余数，返回值也是浮点型
      ```
  - 取模运算，是对两个整型数字，做除法，然后返回余数。例：
    ```c
    printf("%d\n", 0%2);    // 输出为：0
    printf("%d\n", 1%2);    // 输出为：1
    ```

- 关系运算符：
  ```c
  a >  b  // 大于
  a <  b  // 小于
  a >= b  // 大于等于
  a <= b  // 小于等于
  a == b  // 等于
  a != b  // 不等于
  ```
  - 关系运算符，又称为比较运算符，用于比较两个值的大小。
  - 这些比较运算，用汉语描述，有两种结果：真、假。
    - 在 C 语言中，这两种结果分别用整型 1、0 表示。如下：
      ```c
      printf("%d\n", 1>2);  // 1>2 这个表达式，输出为：0
      ```
    - 在 C++ 语言中，这两种结果分别用布尔值 true、false 表示。

- 逻辑运算符：
  ```c
  condition1 && condition2  // 逻辑与。如果两个条件表达式都为 true ，则逻辑运算的结果为 true ，否则结果为 false
  condition1 || condition2  // 逻辑或。如果两个条件表达式，至少一个为 true ，则逻辑运算的结果为 true 。如果两个都为 false ，则结果为 false
  ! condition1              // 逻辑非。如果表达式取值为 true ，则f反转为 false 。如果表达式取值为 false ，则反转为 true
  ```
  - 逻辑运算符，用于组合两个条件表达式。例：
  ```c
  printf("%d\n", (1>2) && (3>2)); // 输出为：0
  printf("%d\n", (1>2) || (3>2)); // 输出为：1
  printf("%d\n", !(1>2));         // 输出为：1
  ```

- 位运算符：
  ```c
  a & b    // 按位与。检查两个操作数的二进制位（bit），如果第 n 位都为 1 ，则结果的第 n 位为 1 ，否则结果的第 n 位为 0

  a | b    // 按位或。如果 a 或 b 的第 n 位为 1 ，则结果的第 n 位为 1 。如果两者都为 0 ，则结果的第 n 位为 0
  a ^ b    // 按位异或。如果 a 与 b 的第 n 位不相同，则结果的第 n 位为 1 ，否则结果的第 n 位为 0
  a << 3   // 按位左移。将操作数的二进制值左移几位，然后在右边空位补上 0
  a >> 3   // 按位右移。
  ~a       // 按位取反。将操作数每一位的值，取反
  ```
  - 位运算用于修改操作数的二进制值，也就是修改某些位（bit）。要求操作数必须是整型。

- 上述运算符，书写格式大多为 `操作数1 运算符 操作数2` ，存在两个操作数，因此属于二元运算符。
- 以下是自增、自减运算符，属于一元运算符：
  ```c
  ++  // 自增
  --  // 自减
  ```
  - 使用 `++` ，可以在读取一个变量的取值的同时，将该变量的取值加 1 。
  - 如果 `++` 放在变量的左侧，则称为前缀自增。会先将该变量的值加 1 ，然后读取该变量的值。例如 `b=++a` 相当于 `a=a+1; b=a;` 。
  - 如果 `++` 放在变量的右侧，则称为后缀自增。会先读取该变量的值，将该变量的值加 1 。例如 `b=a++` 相当于 `b=a; a=a+1;` 。
  - 例：
    ```c
    int a=0;
    printf("%d\n", ++a);  // 输出为：1
    printf("%d\n", a);    // 输出为：1
    a=0;
    printf("%d\n", a++);  // 输出为：0
    printf("%d\n", a);    // 输出为：1
    ```
  - `--` 可以在读取一个变量的取值的同时，将该变量的取值减 1 ，用法与 `++` 同理。

- 以下是条件运算符，它属于三元运算符：
  ```c
  表达式1 ? 表达式2 : 表达式3
  ```
  - 语法为：若表达式 1 结果为 true ，则执行表达式 2 并返回运算结果。若表达式 1 结果为 false ，则执行表达式 3 并返回运算结果。
  - 例：
    ```c
    int a;
    a = 'A'==65 ? 1 : 0;
    ```

- 如果一个表达式中，包含多个运算符，则需要考虑各个运算符的优先级。
  - 如果几个运算符的优先级不同，则找到优先级最高的那个运算符，优先执行它。
  - 如果几个运算符的优先级相同，则按照从左到右的顺序，逐个执行这些运算符，称为左结合性。但某些运算符是右结合性。
    - 例如 `printf("%d\n", 1<3<2);` 的输出为 1 ，因为先计算最左侧的 `<` 运算符，发现 `1<3` 的运算结果为 1 。然后计算 `1<2` ，结果为 1。
  - 各种运算符，按优先级从大到小排列如下：
    - `()` 括号、`[]` 下标
      - 例如 `if(x-- > 2)` 等价于 `if((x--) > 2)`
      - 例如 `if(!x || y--)` 等价于 `if((!x) || (y--))`
    - `!` 逻辑非、`++` 自增、`--` 自减、`+` `-` 正负号、`&` 取地址
      - 这些运算符都是右结合性。
      - 自增、自减运算符只能作用于变量。例如 `++x++` 按右结合性来看，等价于 `++(x++)` ，左边的 `++` 作用于表达式 `(x++)` ，因此语法错误。
    - `*` 乘法、`/` 除法、`%` 取模
    - `+` 加法、`-` 减法
    - `<<` 按位左移、`>>` 按位右移
    - 关系运算符
    - `&&` 逻辑与、`||` 逻辑或
    - 条件运算符
    - `=` 赋值
    - `,` 逗号
      - 逗号的优先级最低。
      - 由逗号连接的多个表达式，称为逗号表达式。C 语言会按左结合性，依次计算各个表达式，然后返回最后一个表达式的值，作为整个逗号表达式的结果。
      - 例：
        ```c
        int a = 0;
        printf("%d\n", (a++, a++, a));  // 输出为 2
        ```

## 流程控制

- C 语言提供了以下几种语法，来控制程序的运行流程：
  - 选择结构
    - if
    - match-case
  - 循环结构
    - for
    - while
    - do-while

### if

- if 语句用于判断条件、选择分支，最简单的格式如下：
  ```py
  if(condition){
      statement_block
  }
  ```
  - 如果 condition 条件表达式结果为 true ，则会执行 statement_block 语句块。否则，跳过 statement_block 。
  - 例：
    ```c
    if(1 > 0)
        printf("yes\n");
    ```
- 可选加上 else 语句，表示条件表达式为 false 时，执行什么操作。如下：
  ```py
  if(condition){
      statement_block
  }
  else{
      statement_block
  }
  ```
- 可选加上任意个 else if 语句，从而依次判断多个条件表达式。如下：
  ```py
  if(condition){
      statement_block
  }
  else if(condition){
      statement_block
  }
  else if(condition){
      statement_block
  }
  ```

- condition 怎么写？
  - 通常是一个表达式，使用比较运算符，或者逻辑运算符。使得表达式的运算结果为整型 1 或 0 ，表示条件为真或假。
  - 也可以是其它类型的表达式，使得运算结果为其它数字、字符、字符串，此时都视作条件为真。如下：
    ```c
    if(1 + 2) // 结果为 3
    if(' ')   // 结果为一个空格字符
    if("")    // 结果为一个空字符串
    ```

### switch

- 如果一个表达式，存在多个可能的取值，需要分情况处理。则可以用多层 else if ，但用 switch 语句更简洁。格式如下：
  ```c
  switch(表达式){
  case value1:    // case 语句的结尾有冒号
      语句块
      break;
  case value2:    // 多个 case 可以共用一个语句块
  case value3:
      语句块
      break;
  default:
      语句块
  }
  ```
  运行流程如下：
  - 首先执行 switch 表达式，得到一个值。然后从上到下检查各个 case ，如果 switch 值与某个 case 值相等，则执行该 case 的语句块。
    - switch 表达式的运算结果，必须是数字或字符、字符串类型。
    - case 的值，必须是常量，不能是变量。
  - 执行每个 case 语句块时，
    - 如果遇到了 break 语句，则会退出整个 switch 语句，执行后续代码。
    - 如果该 case 不存在 break 语句，则会继续检查下一个 case 。
  - 如果没有执行任何 case 语句块，则执行 default 语句块。不过，default 语句块可以省略不写。

- 例：
  ```c
  int x=0;
  switch(a+1){
  case 0:
      printf("hello\n");
      break;
  case 1:
  case '1':
      printf("world\n");
      break;
  default:
      printf("default\n");
  }
  ```

### for

- for 语句用于在某个条件为真时，循环执行某个语句块。格式如下：
  ```c
  for(表达式1; 表达式2; 表达式3){
      循环体语句块
  }
  ```
  运行流程如下：
  - 首先执行一次表达式 1 。
  - 然后判断表达式 2 （属于条件表达式）的结果是真是假。
    - 如果表达式 2 为真，则执行作为循环体的语句块。然后执行一次表达式 3 ，再次判断表达式 2 的真假。
    - 如果表达式 2 为假，则退出 for 循环。
  - 执行循环体时，
    - 如果遇到 break 语句，则会退出该层循环结构。
    - 如果遇到 continue 语句，则会结束本次循环，跳到开始下一次循环。
- 例：打印一连串数字
  ```c
  int i;
  for(i=0; i<5; i++)
      printf("%d\n", i);
  ```

### while

- while 语句相当于简化版的 for 语句。格式如下：
  ```c
  while(条件表达式){
      循环体;
  }
  ```
  运行流程如下：
  - 判断条件表达式的结果是真是假。
    - 如果为真，则执行作为循环体的语句块。然后再次判断条件表达式。
    - 如果为假，则退出 while 循环。

### do-while

- do-while 语句与 while 语句类似，但是先执行一次循环体，然后判断条件表达式。格式如下：
  ```c
  do{
      循环体;
  }
  while(条件表达式);  // 注意这句结尾有分号
  ```

### goto

- goto 用于跳转到指定一个标签，执行从这里开始的代码。
- 优点：可以随意改变程序的运行流程，灵活性大。
- 缺点：灵活性太大，导致源代码难以被人类阅读。因此尽量不用 goto 。
- 例：
  ```c
  #include <stdio.h>

  int main() {
      step1: printf("hello\n");
      step2: printf("world\n");
      goto step1;   // 此时跳转到 step1 处执行代码，而 step1 下面又遇到这个 goto ，导致死循环
      return 0;
  }
  ```

## 函数
