# 类

- Python 既支持创建函数（function），也支持创建类（class），从而实现面向对象编程。
  - 使用类，可以创建一组相似的对象（object），作为该类的不同实例（instance）。
  - 例如：Python 中的 int 数据类型，定义为一个名为 int 的类。1、2、3 等整数，是 int 类的不同实例。

## 定义

- Python 中，使用关键字 `class` 可以定义一个类，一般语法为：
  ```py
  def class_name:
      def method1(args):
          statement_block
      def method2(args):
          statement_block
  ```

- 例：
  ```py
  >>> class Test:
  ...     def __init__(self, a=None, b=None):
  ...         self.a = a    # 这里将输入参数 a ，赋值给实例变量 self.a
  ...         self.b = b
  ...         print(self)
  ...         print('an instance has been initialized.')
  ...     def method1(self):
  ...         print(self.a, self.b)
  ...
  >>> t1 = Test(a=1)   # 创建一个 Test 类的实例，赋值给变量 t1
  <__main__.Test object at 0x0000029AA65C5760>
  an instance has been initialized.
  >>> t1              # 变量 t1 指向一个实例
  <__main__.Test object at 0x0000029AA65C5760>
  >>> t2 = Test()     # 再创建一个实例，可见它拥有不同的 object id
  <__main__.Test object at 0x0000029AA63B9430>
  an instance has been initialized.
  >>> t1 is t2        # t1 与 t2 是不同的对象
  False
  >>> t1.method1()    # 调用 t1 实例的一个方法
  1 None
  ```
  - 调用 `class_name()` 即可创建某个类的一个实例。
  - 调用 `class_name(实参列表)` 可以在创建实例的同时，输入一些参数。这些实参，会被传入 `__init__()` 方法。
  - 创建实例时，不管是否传入参数，都会执行一次 `__init__()` 方法，进行初始化。

## 类的成员

- 类是一种高级的数据结构。在一个类中，
  - 可以定义多个变量，称为该类的属性（attribute）。分为几种：
    - 实例变量（instance variable）
    - 类变量（class variable）
  - 可以定义多个函数，称为该类的方法（method）。分为几种：
    - 实例方法
    - 类方法
    - 静态方法
  - 属性、方法，都称为该类的成员（member）。

- 类成员的访问控制：
  - public
    - ：公有成员。名称不以下划线 `_` 开头，可以被任何对象访问，可以通过 import 语句导入其它脚本。
  - protected
    - ：受保护成员。名称以一个下划线 `_` 开头，只能在当前类或子类中访问，或通过实例访问。
  - private
    - ：私有成员。名称以两个下划线 `__` 开头，只能在当前类中访问。
  - 例：
    ```py
    >>> class Test:
    ...     a = 0
    ...     _b = 0
    ...     __c = 0
    ...
    >>> Test.a
    0
    >>> Test._b
    0
    >>> Test.__c
    AttributeError: 'Test' object has no attribute '__c'
    ```

### 属性

- 实例变量
  - ：该类的每个实例，分别存储一份实例变量，互不影响。
  - 如何访问？
    - 定义类时，只能在方法内，通过 `self.<variable>` 访问实例变量。（`self` 是一个指针，指向类的当前实例）
    - 定义类之后，只能通过 `<instance>.<variable>` 访问实例变量。
  - 例：
    ```py
    >>> class Test:
    ...     def __init__(self, num=0):
    ...         self.num = num
    ...     def get_num(self):
    ...         return self.num
    ...
    >>> t1 = Test(1)
    >>> t1.num
    1
    >>> t1.get_num()
    1
    ```

- 类变量
  - ：在该类中只存储一份，被该类的所有实例共享。
  - 如何访问？
    - 定义类时，
      - 在方法外，创建的变量，都会被视作类变量。
      - 在方法内，可以通过 `cls.<variable>` 访问类变量。（`cls` 是一个指针，指向当前类）
      - 在方法内，也可以通过 `class.<variable>` 访问类变量。
    - 定义类之后，
      - 可以通过 `<class>.<variable>` 访问类变量。
      - 也可以通过 `<instance>.<variable>` 访问，但不能与实例变量重名，否则优先访问实例变量。
  - 例：
    ```py
    >>> class Test:
    ...     total = 0
    ...     def __init__(self, num=0):
    ...         self.num = num
    ...         Test.total += num
    ...     def get_total(cls):
    ...         return cls.total
    ...
    >>> t1 = Test(1)
    >>> t1.get_total()
    1
    >>> t1.total
    1
    >>> Test.total
    1
    >>> t2 = Test(2)
    >>> Test.total    # 不同实例，修改的是同一个类变量
    3
    ```

- Python 允许给一个已经定义的类，添加属性。
  ```py
  >>> t1 = Test()
  >>> t1.name
  AttributeError: 'Test' object has no attribute 'name'
  >>> t1.name = 't1'
  >>> Test.name
  AttributeError: type object 'Test' has no attribute 'name'
  >>> Test.name = 'Test'
  >>> Test.__id = 1   # 私有成员不能在类外被访问，但这里还是赋值成功了
  ```
  - 因此，给一个类或实例，的属性进行赋值时，即使该属性不存在，也可以赋值成功。这可能引发 bug ，建议通过 `__slots__` 声明只允许存在哪些成员。
